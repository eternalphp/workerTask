#!/usr/bin/env php
<?php
//服务进程
require(__DIR__ . "/Worker.php");

$config = json_decode(fread(STDIN,1024),true);
$rules = Job::parseCommand($config);
$sleep = 1;
$start = false;

while(true){
	
	if(date("s") == '00' || $start == true){
		$start = true;
		if($rules["sleep"] > 0){
			$sleep = $rules["sleep"];
			Job::cmdCommand($rules);
		}else{
			$sleep = 60;
			if(Job::checkRule($rules)){
				Job::cmdCommand($rules);
			}
		}
	}
		
	sleep($sleep);
}



?>